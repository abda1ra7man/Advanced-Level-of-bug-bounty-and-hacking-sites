# **Cross-site request forgery (CSRF)**

ูู ุงูุฌุฒุก ุฏูุ ููุดุฑุญ ูุนูู ุฅูู **Cross-Site Request Forgery (CSRF)**ุ ูููุนุฑุถ ุจุนุถ ุงูุฃูุซูุฉ ุนูู ุงูุซุบุฑุงุช ุงูุดุงุฆุนุฉ ูููุ ูููุงู ุฅุฒุงู ุชููุน ุงููุฌูู ุฏู.

## **ุฅูู ูู CSRFุ**

**CSRF** ุฃู **ุชุฒููุฑ ุงูุทูุจุงุช ุนุจุฑ ุงูููุงูุน** ูู ุซุบุฑุฉ ุฃูููุฉ ูู ุงูููุจ ุจุชุณูุญ ููููุงุฌู ุฅูู ูุฌุจุฑ ุงููุณุชุฎุฏููู ุนูู ุชูููุฐ ุนูููุงุช ูู ุบูุฑ ูุง ูููููุง ูุงุตุฏูู ูุนููููุง. ุฏู ุจูุฏูู ุงูููุงุฌู ุงููุฏุฑุฉ ุนูู ุชุฎุทู ุณูุงุณุฉ **Same-Origin Policy** ุงููู ุงูููุฑูุถ ุชููุน ุงูููุงูุน ุงููุฎุชููุฉ ูู ุงูุชุฃุซูุฑ ุนูู ุจุนุถูุง.

```plaintext
https://vulnerable-website.com/email/change?email=pwned@evil-user.net
```

---

## **Labs**

ูู ุนูุฏู ููุฑุฉ ูููุณุฉ ุนู ุฃุณุงุณูุงุช **CSRF** ูุนุงูุฒ ุชุชูุฑู ุนูู ุงุณุชุบูุงููุง ูู ุฃูุฏุงู ุถุนููุฉ ุจุดูู ูุชุนูุฏุ ุชูุฏุฑ ุชูุงูู ูู ุงููุนุงูู ุงูุฎุงุตุฉ ุจุงูููุถูุน ูู ุงููููู ุชุญุช:

๐ [**ุนุฑุถ ูู ูุนุงูู CSRF**](https://portswigger.net/web-security/all-labs#cross-site-request-forgery-csrf)

---
## **ุฅูู ุชุฃุซูุฑ ูุฌูู CSRFุ**

ูู ุงููุฌูู ูุฌุญุ ุงูููุงุฌู ููุฏุฑ ูุฎูู ุงูุถุญูุฉ ุชููุฐ ุนูููุงุช ูู ุบูุฑ ูุง ุชูุตุฏุ ุฒู:

- **ุชุบููุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู** ูู ุงูุญุณุงุจ.
- **ุชุบููุฑ ูููุฉ ุงููุฑูุฑ.**
- **ุชุญููู ุฃููุงู.**

ุนูู ุญุณุจ ููุน ุงูุนูููุฉุ ุงูููุงุฌู ูููู ูุณูุทุฑ ุจุงููุงูู ุนูู ุญุณุงุจ ุงููุณุชุฎุฏู. ููู ูุงู ุงูุญุณุงุจ ุงููู ุชู ุงุฎุชุฑุงูู ููู ุตูุงุญูุงุช ูุจูุฑุฉุ ูุงูููุงุฌู ูููู ูุชุญูู ูู ูู ุจูุงูุงุช ููุธุงุฆู ุงูุชุทุจูู.

---

## **ุฅุฒุงู ุจูุดุชุบู CSRFุ**

ุนุดุงู ูุญุตู ูุฌูู CSRFุ ูุงุฒู ุชุชููุฑ ูฃ ุดุฑูุท ุฃุณุงุณูุฉ:

- **ูุฌูุฏ ุฅุฌุฑุงุก ููู (Relevant Action):** ูุงุฒู ูููู ููู ุนูููุฉ ุฏุงุฎู ุงูุชุทุจูู ููุฏุฑ ุงูููุงุฌู ูุฌุจุฑ ุงูุถุญูุฉ ุนูู ุชูููุฐูุงุ ุฒู ุชุบููุฑ ุงูุตูุงุญูุงุช ุฃู ุชุนุฏูู ุงูุจูุงูุงุช ุงูุฎุงุตุฉ ุจุงููุณุชุฎุฏู.

- **ุงูุงุนุชูุงุฏ ุนูู ุงูุฌูุณุงุช ุจุงูููููุฒ (Cookie-based session handling):** ุงููุฌูู ุจูุชู ุนู ุทุฑูู ุฅุฑุณุงู ุทูุจุงุช HTTPุ ูุงูุชุทุจูู ุจูุณุชุฎุฏู ุงูููููุฒ ููุชุนุฑู ุนูู ุงููุณุชุฎุฏู ุจุฏูู ุฃู ุขููุฉ ุชุญูู ุฅุถุงููุฉ.

- **ุนุฏู ูุฌูุฏ ูุชุบูุฑุงุช ุบูุฑ ูุชููุนุฉ ูู ุงูุทูุจ (No unpredictable request parameters):** ุงูุทูุจุงุช ุงููู ุจุชูููุฐ ุงูุนูููุงุช ูุง ููููุด ูููุง ูุชุบูุฑุงุช ูุงุฒู ุงูููุงุฌู ูุนุฑููุง ูุณุจููุงุ ุฒู ุงูุจุงุณูุฑุฏ ุงููุฏูู ูุจู ุชุบููุฑู.

---
## **ูุซุงู ุนูู ูุฌูู CSRF**

ูู ุงูุชุทุจูู ููู ูุธููุฉ ุจุชุณูุญ ูููุณุชุฎุฏู ุฅูู ูุบูุฑ ุงูุฅูููู ุจุชุงุนูุ ููููู ูุชู ุชูููุฐ ุทูุจ HTTP ุจุงูุดูู ุฏู:

```http
POST /email/change HTTP/1.1
Host: vulnerable-website.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 30
Cookie: session=ytvhwsztyeQkAPzeQ5gHgTvlyxHfsAfE

e-mail=wiener@normal-user.com
```

### **ููู ุงูุทูุจ ุฏู ูุนุฑุถ ูู CSRFุ**

- ุชุบููุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุจูููู ูุฏู ููู ููููุงุฌู ูุฃูู ูููู ูุณุชุบูู ูู ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ูุงูุณูุทุฑุฉ ุนูู ุงูุญุณุงุจ ุจุงููุงูู.
- ุงูุชุทุจูู ุจูุนุชูุฏ ุนูู **ูููู ุงูุฌูุณุฉ (Session Cookie)** ูุชุญุฏูุฏ ูููุฉ ุงููุณุชุฎุฏูุ ุจุฏูู ุฃู ุฑููุฒ ุญูุงูุฉ ุฅุถุงููุฉ.
- ุงูููุงุฌู ููุฏุฑ ูุชููุน ุฃู ูุญุฏุฏ ุงูููู ุงููู ูุญุชุงุฌูุง ุนุดุงู ูููุฐ ุงูุทูุจ ุจูุฌุงุญ.

### **ุฅุฒุงู ุงูููุงุฌู ูุณุชุบู ุงูุซุบุฑุฉุ**

ุงูููุงุฌู ูููู ูุจูู ุตูุญุฉ ููุจ ุจุชูููุฐ ุงูุทูุจ ุฏู ุชููุงุฆููุง:

```html
<html>
<body>
    <form action="https://vulnerable-website.com/email/change" method="POST">
        <input type="hidden" name="email" value="pwned@evil-user.net">
    </form>
    <script>
        document.forms[0].submit();
    </script>
</body>
</html>
```

### **ุฅูู ุงููู ููุญุตู ูู ุงูุถุญูุฉ ูุชุญ ุตูุญุฉ ุงูููุงุฌูุ**

- ุงูุตูุญุฉ ุงูุฎุจูุซุฉ ูุชููุฐ **ุทูุจ HTTP ุชููุงุฆููุง** ูููููุน ุงููุณุชูุฏู.
- ูู ุงููุณุชุฎุฏู **ูุณุฌู ุฏุฎูู**ุ ุงููุชุตูุญ ููุถูู ูููู ุงูุฌูุณุฉ ุชููุงุฆููุง ูู ุงูุทูุจ.
- ุงููููุน ุงููุณุชูุฏู ููุนุชุจุฑ ุงูุทูุจ ุทุจูุนู ูููุบูุฑ ุงูุฅูููู ุจุชุงุน ุงูุถุญูุฉ ุจุฏูู ุนููู.

๐จ **ุงูุญู:** ูุงุฒู ูุชู ุงุณุชุฎุฏุงู **CSRF tokens** ูุน ูู ุงูุทูุจุงุช ุงูุญุณุงุณุฉ ูุชุฌูุจ ุงููุฌูู ุฏู.

## **ููุงุญุธุฉ**

ุนูู ุงูุฑุบู ูู ุฃู CSRF ุนุงุฏุฉู ุจูุชู ุดุฑุญู ูู ุณูุงู **ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ุจุงุณุชุฎุฏุงู ุงูููููุฒ**ุ ุฅูุง ุฅูู ูููู ูุญุตู ูู ุณููุงุฑูููุงุช ุชุงููุฉ ุฒู **ุงููุตุงุฏูุฉ ุนุจุฑ HTTP Basic Authentication** ุฃู **ุงููุตุงุฏูุฉ ุจุงุณุชุฎุฏุงู ุงูุดูุงุฏุงุช ุงูุฑูููุฉ.**

---

## **ุฅุฒุงู ุชูุดุฆ ูุฌูู CSRFุ**

ูุชุงุจุฉ ููุฏ HTML ูุฏูููุง ูุงุณุชุบูุงู **CSRF** ูููู ูููู ูุฌูุฏุ ุฎุงุตุฉู ูู ุงูุทูุจ ุงููุทููุจ ูุญุชูู ุนูู ุนุฏุฏ ูุจูุฑ ูู **ุงููุนุงููุงุช (Parameters)** ุฃู ูู ููู ุชุนููุฏุงุช ุชุงููุฉ. ุฃุณูู ุทุฑููุฉ ูุฅูุดุงุก ูุฌูู CSRF ูู ุงุณุชุฎุฏุงู **ููููุฏ CSRF PoC** ุงููุฏูุฌ ูู **Burp Suite Professional**:

1. ุงุฎุชุฑ ุฃู ุทูุจ HTTP ุฏุงุฎู **Burp Suite Professional** ุงููู ุนุงูุฒ ุชุฌุฑุจู ุฃู ุชุณุชุบูู.
2. ูู **ุงููุงุฆูุฉ ุจุงูุฒุฑ ุงูุฃููู**ุ ุงุฎุชุงุฑ **Engagement tools > Generate CSRF PoC**.
3. **Burp Suite** ูููููุฏ ููุฏ HTML ุฌุงูุฒ ูููุฐ ุงูุทูุจ ุงููู ุงุฎุชุฑุชู (ุจุงุณุชุซูุงุก ุงูููููุฒ ุงููู ููุชู ุฅุถุงูุชูุง ุชููุงุฆููุง ูู ูุชุตูุญ ุงูุถุญูุฉ).
4. ุชูุฏุฑ ุชุนุฏูู ุจุนุถ ุงูุฅุนุฏุงุฏุงุช ูู **ููููุฏ CSRF PoC** ูุถุจุท ุจุนุถ ุงูุชูุงุตูู ุงูุฏูููุฉ ูููุฌูู.
5. ุงูุณุฎ ููุฏ **HTML** ุงูููููููุฏุ ูุญุทู ูู ุตูุญุฉ ููุจุ ุซู ุงูุชุญูุง ูู ูุชุตูุญ ูููู ุงููุณุชุฎุฏู **ูุณุฌู ุฏุฎูู ููู ูููููุน ุงููุณุชูุฏู**ุ ูุดูู ุฅุฐุง ูุงู ุงูุทูุจ ููุชู ุชูููุฐู ุจูุฌุงุญ ููุง ูุฃ.

---

## **ุงููุนูู ุงูุชุฏุฑูุจู** ๐งช
๐ **[ุชุฌุฑุจุฉ ุงุณุชุบูุงู ุซุบุฑุฉ CSRF ุจุฏูู ุญูุงูุฉ](https://portswigger.net/web-security/csrf/lab-no-defenses)**

---
## **ุฅุฒุงู ุชูุตู ุงุณุชุบูุงู CSRFุ**

ุขููุฉ ุชูููุฐ **ูุฌูุงุช CSRF** ุจุชููู ุดุจููุฉ ุฌุฏูุง ุจู **ุงููุฌูุงุช ุงูุนุงูุณุฉ (Reflected XSS)**. ูู ุงูุนุงุฏุฉุ ุงูููุงุฌู ุจูุถูู **ููุฏ HTML ุฎุจูุซ** ูู ูููุน ูู ุจูุชุญูู ูููุ ูุจุนุฏูุง ุจูุญุงูู ูุฌุฐุจ ุงูุถุญุงูุง ูุฒูุงุฑุฉ ุงููููุน ุฏู.

๐ **ุทุฑู ุฌุฐุจ ุงูุถุญุงูุง:**
- ุฅุฑุณุงู ุฑุงุจุท ูููููุน ุงููุตุงุจ ุนุจุฑ **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู** ุฃู **ูุณุงุฆู ุงูุชูุงุตู ุงูุงุฌุชูุงุนู**.
- ูุดุฑ ุงููุฌูู ูู **ูููุน ุดููุฑ** ุฒู ุฎุงูุฉ ุงูุชุนูููุงุชุ ูุงูุชุธุงุฑ ุงูุฒูุงุฑ ููุฏุฎูู.

### **ุงุณุชุบูุงู CSRF ุจุงุณุชุฎุฏุงู GET**

ุจุนุถ ูุฌูุงุช **CSRF ุงูุจุณูุทุฉ** ุจุชุณุชุฎุฏู **ุทุฑููุฉ GET**ุ ูุจุชููู ููุชููุฉ ุจุนููุงู URL ูุงุญุฏ ุนูู ุงููููุน ุงููุณุชูุฏูุ ุจุฏูู ุงูุญุงุฌุฉ ููููุน ุฎุงุฑุฌู.

๐ ูู ุงูุญุงูุฉ ุฏูุ ุงูููุงุฌู ููุฏุฑ ูุฑุณู ุฑุงุจุท ุฎุจูุซ ูุจุงุดุฑุฉู ููุถุญูุฉ ุนูู **ุงููููุน ุงูุถุนูู** ููุณู.

### **ูุซุงู ุนูู ูุฌูู GET:**

```html
<img src="https://vulnerable-website.com/email/change?email=pwned@evil-user.net">
```

-ููุง ููุตุฏ ูู ุงูุถุญูุฉ ูุชุญ ูููุน ููู ุตูุฑุฉ ูุซูุง ููููุง ุงููููู ุฏู ูู ุงูุตูุฑุฉ ูููุบูุฑ ุงูุงูููู ูุซูุง ุงู ูููุฉ ุงูุณุฑ ุจุฏูู ุนููู 

๐ **[ุงูุฑุฃ ุฃูุซุฑ ุนู ุงููุฑู ุจูู XSS ู CSRF](https://portswigger.net/web-security/csrf/xss-vs-csrf)**

---
## **ุฃูู ูุณุงุฆู ุงูุญูุงูุฉ ุถุฏ CSRF**

ูู ุงูููุช ุงูุญุงููุ ุงุณุชุบูุงู ุซุบุฑุงุช **CSRF** ุฃุตุจุญ ูุชุทูุจ ุชุฌุงูุฒ ูุณุงุฆู ุงูุญูุงูุฉ ุงููุทุจููุฉ ูู ูุจู ุงููููุน ุงููุณุชูุฏู ุฃู ูุชุตูุญ ุงูุถุญูุฉ ุฃู ูููููุง. ูู ุฃูู ูุณุงุฆู ุงูุญูุงูุฉ ุงูุชู ูุฏ ุชูุงุฌููุง:

### **๐น CSRF Tokens**
- **ูุตู:** ูู ุฑูุฒ **ุณุฑูุ ูุฑูุฏุ ูุบูุฑ ูุชููุน** ูุชู ุฅูุดุงุคู ูู ุฌูุฉ ุงูุฎุงุฏู ููุดุงุฑูุชู ูุน ุงูุนููู.
- **ุทุฑููุฉ ุงูุญูุงูุฉ:** ุนูุฏ ุชูููุฐ ุนูููุฉ ุญุณุงุณุฉ ูุซู ุฅุฑุณุงู ูููุฐุฌุ ูุฌุจ ุนูู ุงูุนููู ุชุถููู **CSRF Token** ุงูุตุญูุญ ูุน ุงูุทูุจุ ููุง ูุฌุนู ูู ุงูุตุนุจ ุฌุฏูุง ุนูู ุงูููุงุฌู ุฅูุดุงุก ุทูุจ ุตุงูุญ ููุงุจุฉ ุนู ุงูุถุญูุฉ.

### **๐น SameSite Cookies**
- **ูุตู:** ุขููุฉ ุฃูุงู ูู ุงููุชุตูุญ ุชุญุฏุฏ ูุชู ูุชู ุชุถููู ูููุงุช ุชุนุฑูู ุงูุงุฑุชุจุงุท ุงูุฎุงุตุฉ ุจุงููููุน ุนูุฏ ุชูููุฐ ุงูุทูุจุงุช ูู ููุงูุน ุฃุฎุฑู.
- **ุทุฑููุฉ ุงูุญูุงูุฉ:** ุนูุฏ ุชูููุฐ ุนูููุงุช ุญุณุงุณุฉ ุชุชุทูุจ **ูููู ุงูุฌูุณุฉ**ุ ูุฅู ุชูุนูู **ูููุฏ SameSite** ูุฏ ูููุน ุงูููุงุฌู ูู ุชูููุฐ ุงูุทูุจุงุช ุนุจุฑ ุงูููุงูุน.
- **ูุนูููุฉ ูุงูุฉ:** ููุฐ ุนุงู **2021**ุ ูุชุตูุญ **Chrome** ููุฑุถ ุจุดูู ุงูุชุฑุงุถู ูุถุน **Lax** ูู **SameSite Cookies**ุ ููู ุงููุชููุน ุฃู ุชุนุชูุฏ ุงููุชุตูุญุงุช ุงูุฃุฎุฑู ูุฐุง ุงูุณููู ูุณุชูุจููุง.

### **๐น Referer-based Validation**
- **ูุตู:** ุจุนุถ ุงูุชุทุจููุงุช ุชุนุชูุฏ ุนูู **HTTP Referer Header** ููุญุงููุฉ ููุน ูุฌูุงุช CSRF.
- **ุทุฑููุฉ ุงูุญูุงูุฉ:** ูุชู ุงูุชุญูู ููุง ุฅุฐุง ูุงู ุงูุทูุจ ุตุงุฏุฑูุง ูู ููุณ **ูุทุงู ุงูุชุทุจูู**.
- **ูุนุงููุชู:** ูุฐู ุงูุทุฑููุฉ **ุฃูู ููุงุกุฉ** ูู ุงุณุชุฎุฏุงู **CSRF Tokens** ูุฃููุง ูุฏ ุชููู ูุงุจูุฉ ููุชุฌุงูุฒ.

---

## **๐ ุชุฌุงุฑุจ ุนูููุฉ ูุงุฎุชุจุงุฑ ูุณุงุฆู ุงูุญูุงูุฉ**

- ๐ [**ุชุฌุงูุฒ ุญูุงูุฉ CSRF Token**](https://portswigger.net/web-security/csrf/bypassing-token-validation)
- ๐ [**ุชุฌุงูุฒ ูููุฏ SameSite Cookies**](https://portswigger.net/web-security/csrf/bypassing-samesite-restrictions)
- ๐ [**ุชุฌุงูุฒ ุขููุฉ ุงูุญูุงูุฉ ุนุจุฑ Referer**](https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses)
---

๐ **ูููุฒูุฏ ุญูู ููููุฉ ุชุทุจูู ูุฐู ุงููุณุงุฆู ุจุดูู ุตุญูุญุ ุงุทูุน ุนูู:**  
๐ [ููููุฉ ููุน ุซุบุฑุงุช CSRF](https://portswigger.net/web-security/csrf/preventing)

