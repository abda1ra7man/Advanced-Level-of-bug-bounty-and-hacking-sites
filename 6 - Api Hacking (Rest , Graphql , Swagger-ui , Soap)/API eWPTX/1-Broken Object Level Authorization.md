  
# **ثغرة صلاحيات الوصول لمستوى الكائن (Broken Object Level Authorization)**

صلاحيات الوصول لمستوى الكائن هي **استراتيجية للتحكم في الوصول** بيتم تطبيقها على مستوى الكود علشان تضمن إن المستخدم **معاه صلاحية الوصول بس للحاجات اللي المفروض يقدر يشوفها أو يعدلها**.

علشان كده، لازم يتم تنفيذ **فحص صلاحيات مستوى الكائن** عند **كل نقطة نهاية (Endpoint) في الـ API** اللي بتتعامل مع **معرّف كائن (Object ID)** وبتسمح بتنفيذ عمليات عليه.

🔍 **إيه الهدف من الفحوصات دي؟**
- تتأكد إن **المستخدم اللي سجل دخول عنده الصلاحيات الكافية** علشان ينفذ العملية المطلوبة على الكائن اللي بيطلبه.

❌ **إيه اللي ممكن يحصل لو الحماية دي مش مطبقة بشكل صحيح؟**
- تسريب بيانات سرية أو غير مصرح بيها.
- تعديل بيانات بدون إذن.
- حذف بيانات حساسة.

⚠️ **لما النظام ما يكونش فيه الفحص ده، بيبقى فيه ثغرة في صلاحيات مستوى الكائن (Broken Object Level Authorization)، وده ممكن يؤدي لاختراقات خطيرة.**

---

## **بيئة المختبر (Lab Environment)**

في بيئة المختبر دي، هيكون عندك **وصول لجهاز Kali الخاص بالمهاجم**، واللي عليه كل الأدوات المطلوبة مثبتة. **الرابط الأساسي (Base URL) للـ API** هو:
```
http://api.ine.local
```
والتوثيق الخاص بكل الـ APIs ممكن تلاقيه هنا:
```
http://api.ine.local/api/docs
```

### **الهدف:**
- تسجيل الدخول كمستخدم **Bob**.
- استغلال **ثغرة صلاحيات الوصول لمستوى الكائن** علشان تسحب بيانات حساب المستخدم **Carol**.

### **بيانات تسجيل الدخول (Credentials):**
```
Username: Bob
Password: password2
```

### **سيناريو الهجوم:**
- تخيل إنك بتستخدم **تطبيق بنكي**، والمستخدم يقدر يسجل دخوله **باسم المستخدم وكلمة المرور** علشان يشوف تفاصيل حسابه.
- بسبب **ثغرة في صلاحيات الوصول لمستوى الكائن**، ممكن مهاجم **يسحب بيانات مستخدم آخر بدون ما يكون ليه صلاحية فعلية.**


![image](https://github.com/user-attachments/assets/ac41a6dd-ceef-45d4-8472-edd9ca21cc9b)
---
## **تحليل نقاط نهاية الـ API (API Endpoints)**

هنا هتلاقي **نقطتين نهاية (API Endpoints)** مستخدمين في **ثغرة صلاحيات الوصول لمستوى الكائن**:
- **الأولى:** نقطة نهاية `POST` خاصة **بتوثيق المستخدمين (Authentication)**.
- **الثانية:** نقطة نهاية `GET` بتستخدم **لاسترجاع تفاصيل الحساب**.

### **الخطوة 3:**
- افتح **الـ API الخاصة بتوثيق المستخدمين** عن طريق `POST /api1/auth1`.
- راجع **التوثيق الخاص بالـ API** علشان تعرف إزاي بيتم التعامل مع الطلبات.

### **تحليل الطلبات:**
- علشان نرسل طلب للـ API، لازم نمرر القيم التالية **داخل جسم الطلب (Request Body):**

```json
{
    "username": "Bob",
    "password": "password2"
}
```
- لازم يكون **نوع المحتوى (Content-Type) هو JSON** علشان يتم معالجة الطلب بشكل صحيح.

🚀 **دلوقتي بعد ما عرفنا نقاط النهاية واختبرنا التوثيق، هنحاول استغلال الثغرة وسحب بيانات المستخدم الآخر!**

![image](https://github.com/user-attachments/assets/35298cf5-016d-4d73-a2db-40972914125c)

![image](https://github.com/user-attachments/assets/ce5d3900-1876-41c9-af3f-66474b2c6b55)

---
**الخطوة 4:**
- استعرض **توثيق API الخاصة بجلب بيانات الحساب** من `GET /api1/account`.
- الـ API دي بتستقبل **البارامتر** `account_number` داخل **الـ Query String**.
- كمان، لازم يكون فيه **JWT Bearer Token** ضمن **هيدر الطلب (Request Header)** علشان يتم قبول الطلب وتنفيذه بنجاح.


![image](https://github.com/user-attachments/assets/d16cb834-3a8a-483c-a942-89c9a17fad1b)


